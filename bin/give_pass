#! /bin/sh

PASSWD=~/.passwords
FILE="${1:?Need File}"
FILE_GPG="$PASSWD/$FILE.gpg"
WORD=${2:?Need keyword}

function check_dir_permission()
{
   local perm=$(stat -c %a $PASSWD)
   if [[ ! -d $PASSWD ]]; then
      echo "Directory pass not exist"
      exit 1
   fi
   if [[ $perm > 700 ]]; then
      echo "WARM permission trop élevée, plz change to 700"
   fi
}

function if_file_exist() 
{
   local result=$FILE
   if [[ ! -f "$PASSWD/$FILE.gpg" ]]; then
      echo "file : < $result> not exist"
      exit 1
   fi
}

function extract_pass()
{
   local snipe=$(gpg2 --no-tty -qd $FILE_GPG \
      | awk 'BEGIN {{RS="}"} {FS="\n"}} {print $1 $2 $3 $4 $5 $6}' \
         | grep $WORD \
         | awk '{print $5}')
   echo $snipe
}

function give_pass()
{
   check_dir_permission
   if_file_exist
   extract_pass
}

trap "give_pass" EXIT
