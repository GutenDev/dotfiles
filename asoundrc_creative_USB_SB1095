# For Gentoo Install dependencies:
# tap-plugins swh-plugins libsamplerate ladspa-bs2b ladspa-cmt caps-plugins

# For list plugin available for ladspa:
# listplugins
# analyseplugin cmt

defaults.pcm.rate_converter "speexrate_medium"

pcm.!default {
   type plug
   slave.pcm "dmixed"
   device 0
}

ctl.!default {
   type hw
   card Pro
   device 0
}

ctl.softvol {
   type hw
   card Pro
   device 0
}

pcm.softvol {
   type softvol
   slave {
      pcm "dmixed" # or try headphones, upmix_20to51 or upmix_21to51
   }
   control {
      name "Master"
      card Pro
      device 0
   }
}

pcm.dmixed {
   type asym
   playback.pcm {
      type dmix
      ipc_key 5678293
      ipc_perm 0660
      ipc_gid audio
      ipc_key_add_uid 0   
      slave {
         # 2 for stream, 6 for surround51, 8 for surround71
         channels 6
         period_size 512 # 4096
         buffer_size 4096 # 131072
         pcm {
            format S16_LE
            rate 48000
            nonblock true
            type hw 
            card Pro
            device 0 
            subdevice 0
         }
      }
   }
   capture.pcm "dsnoop"
}

pcm.!surround20 {
   type plug
   slave.pcm "dmixed"
}

pcm.!surround40 {
   type plug
   slave.pcm "dmixed"
}

pcm.!surround51 {
   type plug
   slave.pcm "dmixed"
}

pcm.ch51dup {
   slave.pcm "surround51"
   slave.channels 6
   type plug 

   # Front
   ttable.0.0 0.5
   ttable.1.1 0.5

   # Rear
   ttable.2.2 0.5
   ttable.3.5 0.5

   # Center
   ttable.4.4 1

   # LFE
   ttable.5.5 1

   # Front Left/Right to Center
   ttable.0.4 0.5
   ttable.1.4 0.5

   # Front Left/Right to Rear
   ttable.0.2 0.5
   ttable.1.3 0.5
}

# https://forums.gentoo.org/viewtopic-p-4528619.html#4528619
pcm.lowpass_21to21 {
   type ladspa
   slave.pcm upmix_21to51
   path "/usr/lib64/ladspa"
   channels 3
   plugins {
      0 {
         id 1098 # Identity (audio) (1098/identity_audio)
         policy duplicate
         input.bindings.0 "Input";
         output.bindings.0 "Output";
      }
      1 {
         id 1052 # High-pass filter front left
         policy none
         input.bindings.0 "Input";
         output.bindings.0 "Output";
         input {
            controls [ 200 ]
         }
      }
      2 {
         id 1052 # High-pass filter front right
         policy none
         input.bindings.1 "Input";
         output.bindings.1 "Output";
         input {
            controls [ 200 ]
         }
      }
      3 {
         id 1051 ## Low-pass filter 
         policy none
         input.bindings.2 "Input";
         output.bindings.2 "Output";
         input {
            controls [ 200 ]
         }
      }
   }
}

# speaker-test headphone 3 channel ( sound system 2.0 )
pcm.upmix_20to51 {
   type plug
   slave.pcm "lowpass_21to21"
   slave.channels 3
   ttable {
      0.0 1.2  # Left
      1.1 1    # Right
      2.2 1    # mix left and right
      3.3 1    # channel for subwoofer
   }
}

# 6 channel here ( sound system 5.1 )
pcm.upmix_21to51 {
   type plug
   slave.pcm "surround51"
   slave.channels 6
   ttable {
      0.0     1       # front left
      1.1     1       # front right
      0.4     2       # rear left
      1.5     2       # rear right
# Front left/right to center
      0.2     0.5
      1.2     0.5
# Subwoofer, more powerful to compensate for bass-removal from other speakers
      2.5     2
   }
}

# analyseplugin bs2b
pcm.bs2b {
   type ladspa
   path "/usr/lib64/ladspa"
   plugins {
      0 {
         id 4221 # Bauer stereophonic-to-binaural (4221/bs2b)
         input {
            controls [ 725 6 ]
         }
      }
   }
   slave.pcm "surround20"
}

# alternative to bs2b
# analyseplugin caps | grep -A14 Narrow
pcm.narrower {
   type ladspa
   path "/usr/lib64/ladspa"
   plugins {
      0 {
         id 2595 # Narrower - Stereo image width reduction"
         input {
            controls [ 0 0.50 ]
         }
      }
   }
   slave.pcm "surround20"
}

pcm.headphones {
   type rate 
   slave {
      #pcm "plug:bs2b"
      pcm "plug:narrower"
      rate 48000
   }
}
