# Dependencies
# (gentoo): tap-plugins swh-plugins libsamplerate ladspa-cmt caps-plugins

# Find card name:
# aplay -l | awk -F \: '/,/{print $2}' | awk '{print $1}' | uniq

# Rate converter are in /usr/lib64/alsa-lib/libasound_module_rate_<name>.so
defaults.pcm.rate_converter "samplerate_medium"

# Default card
# shown: cat /proc/asound/card0/pcm0p/sub0/hw_params
pcm_slave.sb1095 {
    pcm "hw:Pro"
    format S16_LE
    rate 48000
    channels 6
    period_size 6000
    buffer_size 18000
    period_time 0
}

# speaker-test -Dplug:primal -c2 -t1 -twav
pcm.primal {
    type asym
    playback.pcm {
        type dmix
        ipc_key 5678293
        ipc_key_add_uid false
        ipc_perm 0666
        slave sb1095
    }
    capture.pcm "dsnoop"
}

pcm.!default {
    type plug
    slave.pcm "primal"
}

pcm.!surround20 {
    type plug
    slave.pcm "primal"
}

# Alternative to bs2b | music via Headphones
# analyseplugin caps | grep -A14 Narrow
pcm.narrower {
    type ladspa
    path "/usr/lib64/ladspa"
    plugins {
        0 {
            id 2595
            input {
                controls [ 0 0.25 ]
            }
        }
    }
    slave.pcm "surround20"
}

# speaker-test -Dplug:headphones -c2 -t1 -twav
pcm.headphones {
    type rate
    slave {
        pcm "plug:narrower"
        rate 48000
    }
    converter "samplerate_medium"
    hint {
        show on
        description "Headphones"
    }
}
